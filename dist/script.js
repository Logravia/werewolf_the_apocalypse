(()=>{"use strict";const t=["glory","wisdom","honor","rage","hauglosk","harano"],e=["health_status","willpower_status","crinos_status"],s=["health","willpower","crinos"],a=["empty","full","scratch","grievous"],l=["athletics","brawl","craft","driving","firearms","larceny","melee","stealth","survival","animal_ken","etiquette","insight","intimidation","leadership","performance","persuasion","streetwise","subterfuge","academics","awareness","finance","investigation","medicine","occult","politics","science","technology"],r=["strength","dexterity","stamina","charisma","manipulation","composure","intelligence","wits","resolve"],o=Array.from({length:12},((t,e)=>`advantage_flaw_value${e}`)),i=5,n=10,c={empty:10,full:0,scratch:0,grievous:0,max:3,bonus:0};function u(t,e){const s=$20(`.${t}[value='1']`);if(0!==e){for(let s=1;s<=i;s++){const a=$20(`.${t}[value="${s}"]`);s<=e?a.addClass("selected"):a.removeClass("selected")}1===e&&s.addClass("clear-me")}else s.removeClass("clear-me selected")}function h(t,e){!function(t){let e=a.join(" ");for(let s=1;s<=n;s++)$20(`.${t}`).removeClass(e)}(t);let s=1;for(;s<=e.full;s++)$20(`.${t}[value="${s}"]`).addClass("full");for(;s<=e.scratch+e.full;s++)$20(`.${t}[value="${s}"]`).addClass("scratch");for(;s<=e.grievous+e.scratch+e.full;s++)$20(`.${t}[value="${s}"]`).addClass("grievous");for(;s<=e.grievous+e.scratch+e.full+e.empty;s++)$20(`.${t}[value="${s}"]`).addClass("empty")}function m(t){return t.scratch>0||t.grievous>0}on("sheet:opened",(()=>{!function(t=!1){let e=["health_status","willpower_status","crinos_status"],s={};getAttrs(e,(a=>{e.forEach((e=>{("empty"===a[e]||t)&&(s[e]=c)})),0!==Object.keys(s).length&&setAttrs(s)}))}(),$20(".dot-value-button").on("click",(t=>{let e=parseInt(t.htmlAttributes.value),s=t.htmlAttributes["data-name"];getAttrs(["click_history"],(t=>{(function(t,e,s){const a=t.click_history.name,l=t.click_history.val;return a===e&&1===l&&1===s})(t,s,e)&&(e=0),u(s,e),setAttrs({[s]:e,click_history:{name:s,val:e}})}))})),$20(".health-will-button").on("click",(t=>{let e=t.htmlAttributes["data-name"],s=t.htmlAttributes.class.split(" ").pop(),l=`${e}_status`,r=parseInt(t.htmlAttributes.value);getAttrs([l],(t=>{let o=t[l];1===r&&o.full>1?(o.full-=1,o.empty+=1):(o[s]-=1,o[function(t){const e=(a.indexOf(t)+1)%a.length;return a[e]}(s)]+=1),h(e,o),setAttrs({[l]:o,[`${l}_num`]:o.full})}))})),getAttrs(l.concat(r).concat(t).concat(o),(t=>{Object.keys(t).forEach((e=>{u(e,t[e])}))})),getAttrs(e,(t=>{e.forEach(((e,a)=>{h(s[a],t[e])}))})),$20(".tab-button").on("click",(t=>{let e=t.htmlAttributes.value;$20(".tab").removeClass("active"),$20(`.${e}`).addClass("active")}))})),on("change:stamina",(()=>{getAttrs(["health_status","stamina"],(t=>{if(m(t.health_status))return;let e=t.health_status;e.max=t.stamina+3,e.full=e.max,e.empty=10-e.max,h("health",e),setAttrs({health_status:e,health_status_num:e.full})}))})),on("change:resolve change:composure",(()=>{getAttrs(["willpower_status","resolve","composure"],(t=>{if(m(t.willpower_status))return;let e=t.composure,s=t.resolve,a=t.willpower_status;a.max=e+s,a.full=a.max,a.empty=10-a.max,h("willpower",a),setAttrs({willpower_status:a,willpower_status_num:a.full})}))}))})();